<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Horizon House — Member Application</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Horizon House Sober Living Member Application">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&family=Nunito:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root { --slate:#2b3440; --amber:#c98a22; --sand:#f5f1ea; }
    body { margin:0; font-family:Nunito,system-ui; background:var(--sand); color:var(--slate); }
    header { background:var(--slate); color:#fff; padding:1rem 0; }
    .wrap { max-width:900px; margin:0 auto; padding:1rem; }
    h1, h2 { font-family:Inter; }
    form { display:grid; gap:1rem; background:#fff; padding:1.5rem; border-radius:.5rem; box-shadow:0 2px 6px rgba(0,0,0,.08); }
    label { font-weight:600; }
    input, textarea, select { padding:.6rem; border:1px solid #ccc; border-radius:.4rem; font-size:1rem; width:100%; }
    .inline { display:flex; gap:1rem; }
    .checkbox-group { display:flex; align-items:center; gap:.2rem; }
    @media (max-width: 640px) {
  .inline {
    flex-direction: column;   /* stack YES and NO vertically */
    align-items: flex-start;
  }
  .checkbox-group {
    gap: .1rem;
  }
}
    .section-title { margin-top:1.5rem; font-size:1.3rem; font-family:Inter; }
    button { background:var(--amber); border:none; padding:.8rem 1.2rem; border-radius:.4rem; font-weight:700; cursor:pointer; }
    footer { text-align:center; padding:2rem 0; color:#555; font-size:.9rem; }
  </style>
</head>

<body>

<header>
  <div class="wrap">
    <h1>Horizon House Sober Living — Member Application</h1>
  </div>
</header>

<main class="wrap">

  <div id="savingStatus" style="display:none; padding: 10px; margin-bottom: 15px; border-radius: 4px; text-align: center;">
    <span id="savingMessage">Draft saved</span>
  </div>

  <!-- FORM WITH BACKEND SUBMISSION -->
  <form id="applicationForm">

    <h2 class="section-title">Personal Information</h2>

    <div class="inline">
      <div style="flex:1">
        <label>First Name</label>
        <input type="text" name="first_name" required>
      </div>
      <div style="flex:1">
        <label>Last Name</label>
        <input type="text" name="last_name" required>
      </div>
    </div>

    <label>Address</label>
    <input type="text" name="address">

    <div class="inline">
      <div style="flex:1">
        <label>City</label>
        <input type="text" name="city">
      </div>
      <div style="flex:1">
        <label>State</label>
        <input type="text" name="state">
      </div>
      <div style="flex:1">
        <label>ZIP</label>
        <input type="text" name="zip">
      </div>
    </div>

    <label>Gender</label>
    <div class="inline">
      <label class="checkbox-group"><input type="radio" name="gender" value="male"> Male</label>
      <label class="checkbox-group"><input type="radio" name="gender" value="female"> Female</label>
      <label class="checkbox-group"><input type="radio" name="gender" value="other"> Other</label>
    </div>

    <label>Date of Birth</label>
    <input type="date" name="dob">

    <label>Driver’s License Number</label>
    <input type="text" name="dl_number">

    <label>State</label>
    <input type="text" name="dl_state">

    <label>Vehicle Make & Model</label>
    <input type="text" name="vehicle">

    <label>Cell Phone</label>
    <input type="tel" name="phone">

    <label>Email</label>
    <input type="email" name="email">

    <label>Desired Move‑In Date</label>
    <input type="date" name="move_in">

    <label>Referred By</label>
    <input type="text" name="referred_by">

    <label>Referral Phone</label>
    <input type="tel" name="referral_phone">

    <h2 class="section-title">Treatment & Transition</h2>

    <label>Detox Completed?</label>
    <div class="inline">
      <label class="checkbox-group"><input type="radio" name="detox" value="yes"> Yes</label>
      <label class="checkbox-group"><input type="radio" name="detox" value="no"> No</label>
    </div>

    <label>Inpatient Completed?</label>
    <div class="inline">
      <label class="checkbox-group"><input type="radio" name="inpatient" value="yes"> Yes</label>
      <label class="checkbox-group"><input type="radio" name="inpatient" value="no"> No</label>
    </div>

    <label>Total Days</label>
    <input type="number" name="inpatient_days">

    <label>Treatment Facility</label>
    <input type="text" name="facility">

    <label>Facility Phone</label>
    <input type="tel" name="facility_phone">

    <label>Attending IOP?</label>
    <div class="inline">
      <label class="checkbox-group"><input type="radio" name="iop" value="yes"> Yes</label>
      <label class="checkbox-group"><input type="radio" name="iop" value="no"> No</label>
    </div>

    <label>If yes, where?</label>
    <input type="text" name="iop_where">

    <label>Do you have a job?</label>
    <div class="inline">
      <label class="checkbox-group"><input type="radio" name="job" value="yes"> Yes</label>
      <label class="checkbox-group"><input type="radio" name="job" value="no"> No</label>
    </div>

    <label>If yes, where?</label>
    <input type="text" name="job_where">

    <label>IOP / Work Schedule</label>
    <textarea name="schedule" rows="3"></textarea>

    <label>Drug(s) of Choice</label>
    <input type="text" name="drugs">

    <label>Sobriety Date</label>
    <input type="date" name="sobriety_date">

    <label>Do you have a sponsor?</label>
    <div class="inline">
      <label class="checkbox-group"><input type="radio" name="sponsor" value="yes"> Yes</label>
      <label class="checkbox-group"><input type="radio" name="sponsor" value="no"> No</label>
    </div>

    <h2 class="section-title">Legal Status</h2>

    <label>Are you a 290 PC registrant?</label>
    <div class="inline">
      <label class="checkbox-group"><input type="radio" name="pc290" value="yes"> Yes</label>
      <label class="checkbox-group"><input type="radio" name="pc290" value="no"> No</label>
    </div>

    <label>Currently on probation or parole?</label>
    <div class="inline">
      <label class="checkbox-group"><input type="radio" name="probation" value="yes"> Yes</label>
      <label class="checkbox-group"><input type="radio" name="probation" value="no"> No</label>
    </div>

    <label>Any legal matters pending?</label>
    <div class="inline">
      <label class="checkbox-group"><input type="radio" name="legal_pending" value="yes"> Yes</label>
      <label class="checkbox-group"><input type="radio" name="legal_pending" value="no"> No</label>
    </div>

    <label>If yes to any, provide details</label>
    <textarea name="legal_details" rows="3"></textarea>

    <h2 class="section-title">Medical Information</h2>

    <label>Current Medications</label>
    <textarea name="medications" rows="3"></textarea>

    <label>Medical / Mental Health Conditions or Allergies</label>
    <textarea name="medical" rows="4"></textarea>

    <h2 class="section-title">House Responsibilities</h2>

    <label>Are you willing to do daily chores and help keep the house clean?</label>
    <div class="inline">
      <label class="checkbox-group"><input type="radio" name="chores" value="yes"> Yes</label>
      <label class="checkbox-group"><input type="radio" name="chores" value="no"> No</label>
    </div>

    <h2 class="section-title">Emergency Contact</h2>

    <label>Name</label>
    <input type="text" name="emergency_name">

    <label>Relationship</label>
    <input type="text" name="emergency_relationship">

    <label>Phone</label>
    <input type="tel" name="emergency_phone">

    <label>Email</label>
    <input type="email" name="emergency_email">

    <h2 class="section-title">Certification</h2>

    <label>Name (Typed Signature)</label>
    <input type="text" name="signature" required>

    <label>Date</label>
    <input type="date" name="signature_date" required>

    <div style="background-color: #f0f0f0; padding: 15px; border-left: 4px solid #003366; margin-top: 20px; border-radius: 4px;">
      <strong>⚠️ Staff Approval Required</strong>
      <p>This application will be reviewed and approved by Horizon House staff before being processed. You will receive confirmation once approved.</p>
    </div>

    <div style="display: flex; gap: 10px; margin-top: 20px;">
      <button type="button" onclick="saveDraft()" style="background-color: #666; flex: 1;">Save Draft</button>
      <button type="submit" style="flex: 1;">Submit Application</button>
    </div>

  </form>
</main>

<footer>
  © 2026 Horizon House Sober Living
</footer>

<script>
  const DRAFT_KEY = 'hhApplicationDraft';

  // Load draft on page load
  window.addEventListener('load', () => {
    const draft = localStorage.getItem(DRAFT_KEY);
    if (draft) {
      try {
        const data = JSON.parse(draft);
        Object.keys(data).forEach(key => {
          const field = document.querySelector(`[name="${key}"]`);
          if (field) {
            if (field.type === 'radio') {
              document.querySelector(`[name="${key}"][value="${data[key]}"]`).checked = true;
            } else if (field.type === 'checkbox') {
              field.checked = data[key] === 'on';
            } else {
              field.value = data[key];
            }
          }
        });
      } catch (e) {
        console.error('Error loading draft:', e);
      }
    }
  });

  // Save draft function
  function saveDraft() {
    const formData = new FormData(document.getElementById('applicationForm'));
    const data = {};
    formData.forEach((value, key) => {
      data[key] = value;
    });

    localStorage.setItem(DRAFT_KEY, JSON.stringify(data));

    // Show saved message
    const status = document.getElementById('savingStatus');
    const message = document.getElementById('savingMessage');
    message.textContent = '✓ Draft saved at ' + new Date().toLocaleTimeString();
    status.style.display = 'block';
    status.style.backgroundColor = '#d4edda';
    status.style.color = '#155724';

    setTimeout(() => {
      status.style.display = 'none';
    }, 3000);
  }

  // Auto-save draft every 30 seconds while filling out
  setInterval(() => {
    const form = document.getElementById('applicationForm');
    if (form && form.style.display !== 'none') {
      saveDraft();
    }
  }, 30000);

  document.getElementById('applicationForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    try {
      // Collect all form data
      const formData = new FormData(document.getElementById('applicationForm'));
      const data = {};
      formData.forEach((value, key) => {
        data[key] = value;
      });

      // Submit to backend
      const response = await fetch('https://horizon-portal-backend-production-3532.up.railway.app/api/submitApplication', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      });

      const result = await response.json();

      if (response.ok) {
        // Clear draft after successful submission
        localStorage.removeItem(DRAFT_KEY);
        
        // Show success message
        alert('✓ Application submitted successfully!\n\nYour application has been received and is awaiting staff approval.\n\nApplication ID: ' + result.applicationId);
        document.getElementById('applicationForm').reset();
      } else {
        alert('Error: ' + (result.error || 'Failed to submit application'));
      }
    } catch (error) {
      console.error('Error submitting form:', error);
      alert('Unable to submit application. Please try again or contact support.');
    }
  });
</script>

</body>
</html>

