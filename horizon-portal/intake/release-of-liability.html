<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Release of Liability - Horizon House</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 18px;
            opacity: 0.95;
        }

        .content {
            padding: 40px;
        }

        .intro-text {
            background: #fff5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #e53e3e;
        }

        .intro-text p {
            color: #742a2a;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .intro-text strong {
            color: #c53030;
        }

        .form-section {
            margin-bottom: 35px;
        }

        .section-title {
            font-size: 22px;
            color: #2d3748;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            font-size: 28px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #4a5568;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .required {
            color: #e53e3e;
        }

        .checkbox-group {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
        }

        .checkbox-item label {
            margin: 0;
            font-weight: 500;
            color: #2d3748;
            cursor: pointer;
        }

        .liability-text {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            margin-bottom: 20px;
        }

        .liability-text p {
            color: #2d3748;
            line-height: 1.8;
            margin-bottom: 15px;
            text-align: justify;
        }

        .liability-text strong {
            color: #1a202c;
        }

        .signature-section {
            background: #f7fafc;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
        }

        .signature-input {
            width: 100%;
            padding: 15px;
            font-size: 24px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 15px;
            font-family: 'Brush Script MT', cursive;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        .info-box {
            background: #edf2f7;
            border-left: 4px solid #4299e1;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .info-box p {
            color: #2d3748;
            font-size: 14px;
            line-height: 1.5;
        }

        .warning-box {
            background: #fffaf0;
            border-left: 4px solid #ed8936;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .warning-box p {
            color: #7c2d12;
            font-size: 14px;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .content {
                padding: 25px;
            }

            .header h1 {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† Horizon House</h1>
            <p>Release of Liability & Waiver</p>
        </div>

        <div class="content">
            <div class="intro-text">
                <p><strong>‚ö†Ô∏è Important Legal Document:</strong> This is a release of liability and waiver of legal rights. Please read carefully before signing.</p>
                <p>By signing this document, you acknowledge the risks associated with using Horizon House facilities and voluntarily assume those risks.</p>
            </div>

            <form id="liabilityForm">
                <!-- Participant Information -->
                <div class="form-section">
                    <div class="section-title">
                        <span class="section-icon">üë§</span>
                        Participant Information
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>First Name <span class="required">*</span></label>
                            <input type="text" id="firstName" required>
                        </div>
                        <div class="form-group">
                            <label>Last Name <span class="required">*</span></label>
                            <input type="text" id="lastName" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Date of Birth <span class="required">*</span></label>
                            <input type="date" id="dob" required>
                        </div>
                        <div class="form-group">
                            <label>Phone Number <span class="required">*</span></label>
                            <input type="tel" id="phone" placeholder="(555) 555-5555" required>
                        </div>
                    </div>
                </div>

                <!-- Facilities to be Used -->
                <div class="form-section">
                    <div class="section-title">
                        <span class="section-icon">üèãÔ∏è</span>
                        Facilities I Will Use
                    </div>

                    <div class="info-box">
                        <p>Select all facilities you plan to use during your stay at Horizon House:</p>
                    </div>

                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="facility-pool" value="Swimming Pool/Hot Tub">
                            <label for="facility-pool">Swimming Pool / Hot Tub</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="facility-gym" value="Gym/Fitness Center">
                            <label for="facility-gym">Gym / Fitness Center</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="facility-weights" value="Weight Room">
                            <label for="facility-weights">Weight Room</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="facility-game" value="Game Room">
                            <label for="facility-game">Game Room (Pool Table, Ping Pong, etc.)</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="facility-outdoor" value="Outdoor Recreation Areas">
                            <label for="facility-outdoor">Outdoor Recreation Areas</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="facility-kitchen" value="Kitchen/Cooking Facilities">
                            <label for="facility-kitchen">Kitchen / Cooking Facilities</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="facility-laundry" value="Laundry Facilities">
                            <label for="facility-laundry">Laundry Facilities</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="facility-common" value="Common Areas">
                            <label for="facility-common">Common Areas</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="facility-other" value="Other">
                            <label for="facility-other">Other (specify below)</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Other Facilities (if selected above)</label>
                        <input type="text" id="otherFacilities" placeholder="Please specify...">
                    </div>
                </div>

                <!-- Medical Information -->
                <div class="form-section">
                    <div class="section-title">
                        <span class="section-icon">üè•</span>
                        Medical Information
                    </div>

                    <div class="warning-box">
                        <p><strong>Important:</strong> Please disclose any medical conditions, physical limitations, or health concerns that may affect your safe use of our facilities.</p>
                    </div>

                    <div class="form-group">
                        <label>Known Medical Conditions, Allergies, or Physical Limitations</label>
                        <textarea id="medicalConditions" rows="3" placeholder="List any medical conditions, allergies, injuries, or physical limitations..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Are you currently under a physician's care?</label>
                        <select id="physicianCare">
                            <option value="No">No</option>
                            <option value="Yes">Yes</option>
                        </select>
                    </div>

                    <div class="form-group" id="physicianDetailsGroup" style="display: none;">
                        <label>If yes, please provide details:</label>
                        <textarea id="physicianDetails" rows="2" placeholder="Describe the reason and any restrictions..."></textarea>
                    </div>
                </div>

                <!-- Release of Liability -->
                <div class="form-section">
                    <div class="section-title">
                        <span class="section-icon">‚öñÔ∏è</span>
                        Release of Liability & Assumption of Risk
                    </div>

                    <div class="liability-text">
                        <p><strong>ASSUMPTION OF RISK:</strong> I understand that the use of Horizon House facilities, including but not limited to the swimming pool, hot tub, gym, fitness equipment, weight room, game room, kitchen, and recreational areas involves inherent risks of injury, illness, or death. These risks include, but are not limited to: slips and falls, drowning, equipment malfunction, burns, cuts, sprains, strains, broken bones, head injuries, and other bodily harm.</p>

                        <p><strong>ACKNOWLEDGMENT:</strong> I acknowledge that I am voluntarily participating in these activities with full knowledge of the potential dangers involved. I accept and assume full responsibility for all risks associated with my use of Horizon House facilities.</p>

                        <p><strong>RELEASE AND WAIVER:</strong> In consideration for being permitted to use Horizon House facilities, I hereby release, waive, discharge, and covenant not to sue Horizon House, its owners, operators, employees, volunteers, and agents from any and all liability, claims, demands, actions, and causes of action whatsoever arising out of or related to any loss, damage, or injury, including death, that may be sustained by me while using any Horizon House facilities or equipment.</p>

                        <p><strong>INDEMNIFICATION:</strong> I agree to indemnify and hold harmless Horizon House, its owners, operators, employees, volunteers, and agents from any loss, liability, damage, or costs that may occur as a result of my use of the facilities, whether caused by negligence or otherwise.</p>

                        <p><strong>MEDICAL CONSENT:</strong> In the event of an injury or medical emergency, I authorize Horizon House staff to obtain emergency medical treatment on my behalf. I agree to be financially responsible for any costs incurred as a result of such treatment.</p>
                    </div>

                    <div class="checkbox-group" style="background: #fff5f5; border: 2px solid #e53e3e;">
                        <div class="checkbox-item">
                            <input type="checkbox" id="agreeRelease" required>
                            <label for="agreeRelease" style="font-weight: 600; color: #c53030;">
                                I have read and understand the Release of Liability, Assumption of Risk, and Waiver of Claims stated above. I agree to be bound by its terms. <span class="required">*</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Safety Rules Acknowledgment -->
                <div class="form-section">
                    <div class="section-title">
                        <span class="section-icon">‚úÖ</span>
                        Safety Rules & Responsibilities
                    </div>

                    <div class="info-box">
                        <p>I agree to follow all posted safety rules and regulations for each facility, including:</p>
                    </div>

                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="rule-supervision" required>
                            <label for="rule-supervision">I understand there is NO lifeguard on duty and I swim/use pool at my own risk <span class="required">*</span></label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="rule-equipment" required>
                            <label for="rule-equipment">I will use all equipment properly and as intended <span class="required">*</span></label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="rule-limits" required>
                            <label for="rule-limits">I will not exceed my physical limitations or abilities <span class="required">*</span></label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="rule-report" required>
                            <label for="rule-report">I will immediately report any unsafe conditions or equipment to staff <span class="required">*</span></label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="rule-influence" required>
                            <label for="rule-influence">I will NOT use facilities while under the influence of drugs or alcohol <span class="required">*</span></label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="rule-hours" required>
                            <label for="rule-hours">I will only use facilities during designated hours <span class="required">*</span></label>
                        </div>
                    </div>
                </div>

                <!-- Photo/Video Release (Optional) -->
                <div class="form-section">
                    <div class="section-title">
                        <span class="section-icon">üì∏</span>
                        Photo & Video Release (Optional)
                    </div>

                    <div class="info-box">
                        <p>Horizon House occasionally takes photos and videos for promotional purposes, social media, and program documentation.</p>
                    </div>

                    <div class="form-group">
                        <label>Do you grant permission for Horizon House to use your image?</label>
                        <select id="photoRelease">
                            <option value="No">No, I do NOT grant permission</option>
                            <option value="Yes">Yes, I grant permission</option>
                        </select>
                    </div>
                </div>

                <!-- Signature Section -->
                <div class="signature-section">
                    <div class="section-title">
                        <span class="section-icon">‚úçÔ∏è</span>
                        Electronic Signature
                    </div>
                    
                    <div class="warning-box" style="margin-top: 15px;">
                        <p><strong>LEGAL NOTICE:</strong> By signing below, I certify that I have read this entire document, understand its contents, and sign it as my own free act. I understand that this is a legally binding agreement.</p>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label>Full Name (Type to Sign) <span class="required">*</span></label>
                        <input type="text" id="signature" class="signature-input" required placeholder="Type your full name here">
                    </div>

                    <div class="form-group">
                        <label>Date <span class="required">*</span></label>
                        <input type="date" id="signatureDate" required>
                    </div>

                    <div class="checkbox-group" style="background: #fff5f5; border: 2px solid #e53e3e; margin-top: 20px;">
                        <div class="checkbox-item">
                            <input type="checkbox" id="certify" required>
                            <label for="certify" style="font-weight: 600; color: #c53030;">
                                I certify that I am at least 18 years of age and have the legal capacity to sign this agreement. I understand this is a release of liability and a contract between myself and Horizon House. <span class="required">*</span>
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary" id="submitBtn" disabled>
                        Submit Release of Liability
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_URL = 'https://horizon-portal-backend-production-3532.up.railway.app';

        // Set today's date as default
        document.getElementById('signatureDate').valueAsDate = new Date();

        // Show physician details if under care
        document.getElementById('physicianCare').addEventListener('change', function() {
            const detailsGroup = document.getElementById('physicianDetailsGroup');
            detailsGroup.style.display = this.value === 'Yes' ? 'block' : 'none';
        });

        // Enable submit button only when all required checkboxes are checked
        function checkRequiredCheckboxes() {
            const agreeRelease = document.getElementById('agreeRelease').checked;
            const certify = document.getElementById('certify').checked;
            const allSafetyRules = [
                'rule-supervision',
                'rule-equipment',
                'rule-limits',
                'rule-report',
                'rule-influence',
                'rule-hours'
            ].every(id => document.getElementById(id).checked);

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = !(agreeRelease && certify && allSafetyRules);
        }

        // Add listeners to all required checkboxes
        ['agreeRelease', 'certify', 'rule-supervision', 'rule-equipment', 'rule-limits', 
         'rule-report', 'rule-influence', 'rule-hours'].forEach(id => {
            document.getElementById(id).addEventListener('change', checkRequiredCheckboxes);
        });

        document.getElementById('liabilityForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // Collect facilities
            const facilities = [];
            document.querySelectorAll('[id^="facility-"]:checked').forEach(cb => {
                facilities.push(cb.value);
            });

            if (facilities.length === 0) {
                alert('Please select at least one facility you plan to use.');
                return;
            }

            // Collect safety rules
            const safetyRules = [
                'No lifeguard on duty - swim at own risk',
                'Use equipment properly and as intended',
                'Do not exceed physical limitations',
                'Report unsafe conditions immediately',
                'No use while under influence of drugs/alcohol',
                'Use facilities only during designated hours'
            ];

            // Prepare form data
            const formData = {
                participantInfo: {
                    firstName: document.getElementById('firstName').value,
                    lastName: document.getElementById('lastName').value,
                    dob: document.getElementById('dob').value,
                    phone: document.getElementById('phone').value
                },
                facilities: facilities,
                otherFacilities: document.getElementById('otherFacilities').value,
                medicalInfo: {
                    conditions: document.getElementById('medicalConditions').value,
                    underPhysicianCare: document.getElementById('physicianCare').value,
                    physicianDetails: document.getElementById('physicianDetails').value
                },
                agreementsAccepted: {
                    assumptionOfRisk: true,
                    releaseOfLiability: true,
                    medicalConsent: true,
                    safetyRules: safetyRules
                },
                photoRelease: document.getElementById('photoRelease').value,
                signature: document.getElementById('signature').value,
                signatureDate: document.getElementById('signatureDate').value,
                submittedAt: new Date().toISOString(),
                ipAddress: await fetch('https://api.ipify.org?format=json')
                    .then(r => r.json())
                    .then(d => d.ip)
                    .catch(() => 'unknown')
            };

            try {
                const response = await fetch(`${API_URL}/api/intake/release-of-liability`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.success) {
                    alert(`Thank you, ${formData.participantInfo.firstName}! Your Release of Liability has been submitted successfully.\n\nYou may now use the facilities. Please remember to follow all safety rules.`);
                    
                    setTimeout(() => {
                        // Redirect to next form or dashboard
                        window.location.href = '../members/dashboard.html';
                    }, 1500);
                } else {
                    throw new Error('Failed to submit form');
                }
            } catch (error) {
                console.error('Error submitting form:', error);
                alert('There was an error submitting your form. Please try again or contact staff.');
            }
        });
    </script>
</body>
</html>
