<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Responsibility Agreement - Horizon House</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            max-width: 700px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            padding: 40px;
        }
        h1 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2rem;
        }
        .info {
            font-size: 1.1rem;
            margin-bottom: 30px;
            color: #333;
        }
        label {
            font-weight: 600;
            margin-top: 20px;
            display: block;
        }
        input, textarea {
            width: 100%;
            padding: 12px;
            margin-top: 8px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1rem;
        }
        .actions {
            margin-top: 30px;
            display: flex;
            gap: 16px;
        }
        .btn {
            padding: 14px 32px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            background: #667eea;
            color: white;
            transition: background 0.2s;
        }
        .btn.skip {
            background: #e0e0e0;
            color: #333;
        }
        .btn:hover:not(.skip) {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Financial Responsibility Agreement</h1>
        <div class="info">
            This form is for members whose housing fees are paid by insurance, medical, or IEHP benefits, or any other source than yourself. If your benefits are cut off, run out, or otherwise become unavailable, you agree to be financially responsible for your continued stay at Horizon House. If this does not apply to you, you may skip this form.
        </div>
        <form id="financialForm">
            <label for="memberName">Member Name</label>
            <input type="text" id="memberName" name="memberName" required>

            <label for="memberId">Member ID</label>
            <input type="text" id="memberId" name="memberId" required>

            <label for="insuranceType">Insurance/Benefit Type (if applicable)</label>
            <input type="text" id="insuranceType" name="insuranceType">

            <div style="margin: 32px 0 18px 0; padding: 18px; background: #f8f9fa; border-left: 4px solid #667eea; border-radius: 8px; display: flex; align-items: flex-start; gap: 14px;">
                <input type="checkbox" id="agreeCheckbox" style="margin-top:4px;flex-shrink:0;">
                <div>
                    <label for="agreeCheckbox" style="font-size:17px;vertical-align:middle;display:block;margin-bottom:8px;">
                        I have read and agree to the following:
                    </label>
                    <div id="agreementText" style="font-size:16px; color:#333;">
                        I understand that if my insurance, medical, or IEHP benefits are discontinued, exhausted, or otherwise unavailable, I am responsible for paying all program fees directly to Horizon House. I agree to notify staff immediately if my benefits change, and I understand that failure to pay may result in discharge from the program.
                    </div>
                </div>
            </div>

            <label for="caseWorker">Case Worker/Navigator Name</label>
            <input type="text" id="caseWorker" name="caseWorker" placeholder="Enter case worker or navigator name">

            <label for="caseWorkerPhone">Case Worker/Navigator Phone</label>
            <input type="tel" id="caseWorkerPhone" name="caseWorkerPhone" placeholder="Enter phone number">

            <div style="margin-bottom: 18px;">
                <label style="font-weight:600;display:block;margin-bottom:8px;">Choose Signature Method</label>
                <div style="display:flex;gap:24px;align-items:center;">
                    <label style="font-weight:500;">
                        <input type="radio" name="sigMethod" id="sigTypeRadio" checked onchange="toggleSignatureMethod()"> Type Signature
                    </label>
                    <label style="font-weight:500;">
                        <input type="radio" name="sigMethod" id="sigDrawRadio" onchange="toggleSignatureMethod()"> Draw Signature
                    </label>
                </div>
            </div>
            <div id="typedSigSection">
                <label for="signature">Signature (Type your full name)</label>
                <input type="text" id="signature" name="signature" placeholder="Type your full name as signature">
            </div>
            <div id="drawSigSection" style="display:none;">
                <label style="font-weight:600;display:block;margin-bottom:8px;">Draw Your Signature</label>
                <div style="width:100%;max-width:600px;">
                    <canvas id="signaturePad" width="600" height="150" style="border:2px dashed #667eea; border-radius:8px; width:100%; min-width:300px; min-height:120px; background:white; cursor:crosshair;"></canvas>
                </div>
                <div style="margin-top:8px;display:flex;align-items:center;gap:12px;">
                    <button type="button" class="btn skip" style="padding:8px 18px;" onclick="clearSignature()">Clear Signature</button>
                    <span id="signatureStatus" style="color:#718096;font-size:14px;">Signature required</span>
                </div>
            </div>

            <div class="actions">
                <button type="submit" class="btn">Submit</button>
                <button type="button" class="btn skip" onclick="skipForm()">Skip</button>
            </div>
        </form>
    </div>
    <script>
    // Signature Pad Logic
    let canvas, ctx, isDrawing = false, hasSignature = false;
    function initializeSignaturePad() {
        canvas = document.getElementById('signaturePad');
        if (!canvas) return;
        ctx = canvas.getContext('2d');
        // Set canvas size for high DPI
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * 2;
        canvas.height = rect.height * 2;
        canvas.style.width = rect.width + 'px';
        canvas.style.height = rect.height + 'px';
        ctx.scale(2, 2);
        ctx.strokeStyle = '#000';
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        // Drawing events
        const getCoordinates = (e) => {
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches ? e.touches[0] : e;
            return {
                x: touch.clientX - rect.left,
                y: touch.clientY - rect.top
            };
        };
        const startDrawing = (e) => {
            e.preventDefault();
            isDrawing = true;
            const coords = getCoordinates(e);
            ctx.beginPath();
            ctx.moveTo(coords.x, coords.y);
        };
        const draw = (e) => {
            e.preventDefault();
            if (!isDrawing) return;
            const coords = getCoordinates(e);
            ctx.lineTo(coords.x, coords.y);
            ctx.stroke();
            hasSignature = true;
            document.getElementById('signatureStatus').textContent = 'Signature captured âœ“';
            document.getElementById('signatureStatus').style.color = '#48bb78';
        };
        const stopDrawing = (e) => {
            e.preventDefault();
            isDrawing = false;
        };
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);
        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', stopDrawing);
    }
    function clearSignature() {
        if (!canvas || !ctx) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        hasSignature = false;
        document.getElementById('signatureStatus').textContent = 'Signature required';
        document.getElementById('signatureStatus').style.color = '#718096';
    }
    function toggleSignatureMethod() {
        const typeRadio = document.getElementById('sigTypeRadio');
        const typedSection = document.getElementById('typedSigSection');
        const drawSection = document.getElementById('drawSigSection');
        if (typeRadio.checked) {
            typedSection.style.display = '';
            drawSection.style.display = 'none';
        } else {
            typedSection.style.display = 'none';
            drawSection.style.display = '';
        }
    }
    function skipForm() {
        // Mark as skipped and proceed to next form in intake flow
        if (window.sessionStorage) {
            sessionStorage.setItem('financialResponsibilitySkipped', 'true');
        }
        alert('You have chosen to skip this form. Staff may revisit this with you if needed.');
        // Redirect or trigger next step in intake
        if (typeof goToNextForm === 'function') {
            goToNextForm();
        } else {
            window.location.href = '../members/dashboard.html';
        }
    }
    document.getElementById('financialForm').onsubmit = function(e) {
        e.preventDefault();
        // Validate agreement checkbox
        if (!document.getElementById('agreeCheckbox').checked) {
            alert('You must agree to the terms before signing.');
            return;
        }
        // Validate signature (typed or drawn, one required)
        const typeRadio = document.getElementById('sigTypeRadio');
        let signature = '', signatureDataURL = '';
        if (typeRadio.checked) {
            signature = document.getElementById('signature').value.trim();
            if (!signature) {
                alert('Please type your full name as signature.');
                return;
            }
        } else {
            if (!hasSignature) {
                alert('Please draw your signature.');
                return;
            }
            signatureDataURL = canvas.toDataURL('image/png');
        }
        const data = {
            memberName: document.getElementById('memberName').value,
            memberId: document.getElementById('memberId').value,
            insuranceType: document.getElementById('insuranceType').value,
            agreementText: document.getElementById('agreementText').textContent,
            agreed: document.getElementById('agreeCheckbox').checked,
            signature: signature,
            signatureDrawn: signatureDataURL,
            caseWorker: document.getElementById('caseWorker').value,
            caseWorkerPhone: document.getElementById('caseWorkerPhone').value,
            date: new Date().toISOString()
        };
        // Store in sessionStorage for now (replace with API call as needed)
        if (window.sessionStorage) {
            sessionStorage.setItem('financialResponsibilityForm', JSON.stringify(data));
        }
        alert('Financial Responsibility Agreement submitted.');
        if (typeof goToNextForm === 'function') {
            goToNextForm();
        } else {
            window.location.href = '../members/dashboard.html';
        }
    };
    // Initialize signature pad and toggle logic after DOM loads
    window.addEventListener('DOMContentLoaded', function() {
        initializeSignaturePad();
        toggleSignatureMethod();
    });
    </script>
</body>
</html>
